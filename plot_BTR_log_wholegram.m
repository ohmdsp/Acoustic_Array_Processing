function plot_BTR_log_wholegram(btr_energy,Ts,angle_step,seg_size,overlap,offset)% Filename:         plot_MUSIC_gram.m% Author:           D.R.Ohm   % Software:         Matlab R2020b% Rev.Date:         Sept.26,2005; Mar.1,2021%% btr       a two-dimensional array of Energy values from Array_BTR.m %           arranged by time bins vs bearing values % Fs        Sampling rate in samples per second (Hz)% seg_size% overlap   the overlap between analysis center times, in number of%           samples (use same value as entered in the % offset    angle in radians used to offset start of bearning calulations%           (need to offset plot) %==========================================================================%-Compute magnitude and log for tf gramsep = 1.0e-16;gram = btr_energy;[n_rows,n_cols]=size(gram);%load convoy1_doa.mat;gps_aval = input('Is GPS data available? (1-Yes, 0-No) ');if gps_aval==1    disp('Select GPS data file (.mat) ');    filename = uigetfile('*.mat','Select data to load');    %pathplusfile = [pathname filename];    load(filename)    target = input('How many targets have GPS data? ');end%-Compute magnitude and log ranges for gram plotsmax_gram        = max(max(abs(gram)));log_gram        = 10*log10(abs(gram)/max_gram);dB_top          = input('Enter top range in dB (example: 0): ');dB_bottom       = input('Enter bottom range in dB (example: 65): ');vec             = find(log_gram < (-dB_bottom));log_gram(vec)   = -dB_bottom*ones(size(vec));vec             = find(log_gram > (-dB_top));log_gram(vec)   = -dB_top*ones(size(vec));selection = 1;%input('Enter 0 for gray scale, 1 for color scale: ');figure('PaperOrientation','portrait',...              'PaperPosition',[1.1,1,6.5,9],...              'Position',[10,10,820,620],...              'Units','pixel');            shift = seg_size - overlap;b_axis = (0:1:n_rows)*angle_step*180/pi - 180 + offset;   % note convert to degreesbmax = b_axis(end);bmin = b_axis(1);max_delay = 40;  % used in main routine and must be accounted for heret_axis = (0:n_cols)*shift*Ts + max_delay*Ts;tmax = t_axis(end);             % max time in seconds (or time_unit used)% b_axis = (-n_rows/2:1:n_rows/2)*angle_step*180/pi;   % note convert to degrees% bmax = max(b_axis);% t_axis = (0:n_cols)*shift*Ts;% tmax = t_axis(end);                      % max time in seconds (or time_unit used)axwidth = .82;  axes('Position',[.1,.96,axwidth,1],...                'Units','normalized',...                'Visible','off');            text('Position',[.5,0],...                  'Units','normalized',...                  'FontSize',[14],...                  'HorizontalAlignment','center',...                  'VerticalAlignment','bottom',...                  'String','LOG BEARING - VS - TIME GRAM');              %-Bearing gram 2D plotaxbottom = .15;axheight = .79;ax1 = axes('Position',[.1,axbottom,axwidth,axheight],...           'Units','normalized',...           'FontSize',14,...           'Box','on',...           'TickDir','out',...           'NextPlot','add',...           'XGrid','off',...           'XLim',[0,tmax],...           'YLim',[bmin,bmax]);if selection == 0    colormap(gray(256));else    map = hsv(329);    colormap(map(256:-1:1,:));endset(ax1,'FontSize',[10])xlabel('Bearing (degrees)')ylabel('Center Time of Analysis Window  (sec)')imagesc(t_axis,b_axis,log_gram)if gps_aval == 1    hold on    plot(t11,doa11,'*b','LineWidth', 1.0)    if target==2            plot(t21,doa21,'*k','LineWidth', 1.0);    end    hold off    legend('gps target 1', 'gps target 2')end%-Color bar legend on left bottomax5 = axes('Position',[.04,.07,.10,.03],...           'Units','normalized',...           'Box','on',...           'NextPlot','add',...           'FontSize',[9],...           'YLim',[1,2],...           'TickDir','out',...           'YTickLabelMode','manual',...           'YTickLabel',[],...           'XLim',[-dB_bottom,-dB_top]);vec = (-dB_bottom:-dB_top)';barr = [vec vec]';imagesc((-dB_bottom:-dB_top),(1:2),barr)xlabel('dB colormap')